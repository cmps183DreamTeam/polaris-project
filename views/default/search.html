<html>
    <head>
        <title>Search</title>
        <link href = "{{=URL('static','css/global.css')}}" type ="text/css" rel="stylesheet">
        <script src="{{=URL('static', 'js/vue.js')}}"></script>
        <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>


        <!-- Sources for D3 table -->
        <script src="{{=URL('static', 'js/makeTable.js')}}"></script>
        <script src="http://d3js.org/d3.v3.min.js"></script>
        <script src="https://cdn.datatables.net/1.10.9/js/jquery.dataTables.min.js"></script>
        <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.9/css/jquery.dataTables.min.css">


        <!-- One page website -->
        <link href = "{{=URL('static','css/jquery.fullPage.css')}}" rel="stylesheet" type="text/css">
        <script src="{{=URL('static', 'js/jquery.easings.min.js')}}"></script>
        <script src="{{=URL('static', 'js/jquery.fullPage.min.js')}}"></script>

        <!-- One page script function -->
        <script>
            $(document).ready(function()
            {
                $('#fullpage').fullpage({
                    sectionsColor: ['#f2f2f2', '#4BBFC3', '#7BAABE', 'whitesmoke', '#000'],
                });
            });
        </script>

        <script>
            var posts_url = "{{=URL('default', 'get_posts')}}";
            var add_post_url = "{{=URL('default', 'add_post', user_signature=True)}}";
            var edit_post_url = "{{=URL('default', 'edit_post', user_signature=True)}}";
            var del_post_url = "{{=URL('default', 'del_post', user_signature=True)}}";
            var show_name = false;
        </script>
    </head>
    <body>
        <div id="fullpage">
            <!--0nd section-->
            <div class="section">
                <div id='container'></div>
                <div id='highlighted'>Nothing Highlighted</div>
                <div id='selected'>Nothing Selected</div>
                <script>
                    var json_str = '{{=XML(json_dict)}}';

                    console.log(json_str);


                    var arr = JSON.parse(json_str);
                    console.log(arr);


                    var table_plot = makeTable()
                      .datum(arr)
                      .sortBy('mag', true)

                    d3.select('#container').call(table_plot);

                    table_plot.on('highlight', function(data, on_off)
                    {
                      if(on_off)
                      {
                          //if the data is highlighted
                           d3.select('#highlighted').text('Mouse on row '  + data.GeneID);
                      }
                    });

                    table_plot.on('select', function(data, on_off)
                    {
                      if(on_off)
                      {
                          //if the data is highlighted
                        d3.select('#selected').text(
                          'Last clicked row was ' + data.GeneID
                        );
                      }
                    });

                </script>
            </div>

            <!--1st old style (python generated table) section-->
            <div class="section">
                <a class="back-button" href="{{=URL('default','index')}}">Back</a>

                <div style="float: right;margin-right: 25%;margin-bottom: 10px;">
                    Approx-ed Strehl Value: <div class="dynamic" id="strehl"></div>
                </div>
                <div id="results-table">
                    <table class="table">
                        <thead>
                            <tr>
                                <!--<td>Name</td>-->
                                <td>RA</td>
                                <td>DEC</td>
                                <td>Magnitude</td>
                                <td>Epoch Red Mag</td>
                            </tr>
                        </thead>
                        <tbody>
                            {{for entry in dict:}}
                                <tr>
                                    <!--<td id="name">{{=reqs.name}}</td>-->
                                    <td id="ra">{{=entry['RA']}}</td>
                                    <td id="dec">{{=entry['DEC']}}</td>
                                    <td id="magnitude">{{=entry['mag']}}</td>
                                    <td id="magnitude_type">{{=entry['mag_type']}}</td>
                                </tr>
                            {{pass}}
                        </tbody>
                    </table>
                </div>
                <button style="background-color: white; border-color: lightgrey; border-width: inherit;"
                        id="save_query_button" class="button" align="right"
                        href="{{=URL('default','save_query', user_signature=True)}}">
                    Save this query
                </button>
            </div>

            <!--2nd section-->
            <div class="section">
                <a class="back-button" href="{{=URL('default','index')}}">Back</a>
                <div id="input-form" class="form-modal">
                    <form enctype="multipart/form-data" method="POST" action="{{= URL('default', 'search')}}">
                        <div class="button" id="pick_by_name" style="color: grey;background-color: white;margin-bottom: 10px;border-color: white;">
                            Pick a target by name
                        </div>
                        <input style="display: none;" id="name" class="input" type="text" name="name" placeholder="Target Name: {{=reqs.name}}">
                        <input class="input" type="text" name="ra" placeholder="RA: {{=reqs.ra}}">
                        <input class="input" type="text" name="dec" placeholder="DEC: {{=reqs.dec}}">
                        <input class="input" type="text" name="rad" placeholder="Radius: {{=reqs.rad}}"/>
                        <input type="range" name="points" min="1" max="10" step="0.5"placeholder="Pick Radius θ">Pick Radius θ</form>
                        <input class="input" type="text" name="wavelength" placeholder="Observed Wavelength λ"/>
                        <select class="input" name="cat">
                            <option value="USNO-B1">USNO-B1</option>
                        </select>
                        <input class="button" type="submit" value="Submit">
                    </form>
                </div>
            </div>

        </div>
    </body>
</html>